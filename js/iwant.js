
$(function () {
    var cookie = $.cookie('iwantcookie');

    if (cookie != null) {
        var Link = cookie.split("iwantcn");
        switch (Link.length) {
            case 2:
                $("<li><a target=\"_blank\" href='" + Link[1] + "'>" + Link[0] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
                break;
            case 4:
                $("<li><a target=\"_blank\" href='" + Link[1] + "'>" + Link[0] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[3] + "'>" + Link[2] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"../../images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
                break;
            case 6:
                $("<li><a target=\"_blank\" href='" + Link[1] + "'>" + Link[0] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[3] + "'>" + Link[2] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[5] + "'>" + Link[4] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
                break;
            case 8:
                $("<li><a target=\"_blank\" href='" + Link[1] + "'>" + Link[0] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[3] + "'>" + Link[2] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[5] + "'>" + Link[4] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[7] + "'>" + Link[6] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
                break;
            case 10:
                $("<li><a target=\"_blank\" href='" + Link[1] + "'>" + Link[0] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[3] + "'>" + Link[2] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[5] + "'>" + Link[4] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[7] + "'>" + Link[6] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[9] + "'>" + Link[8] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
                break;
            case 12:
                $("<li><a target=\"_blank\" href='" + Link[1] + "'>" + Link[0] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[3] + "'>" + Link[2] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"../../images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[5] + "'>" + Link[4] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[7] + "'>" + Link[6] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[9] + "'>" + Link[8] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href='" + Link[11] + "'>" + Link[10] + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
                $("div.mainB_r_c ul li:last-child").hide();
                break;
            default:
                break;
        }
    }
    else {
        $.cookie('iwantcookie', '¹þÀ­×åhttp://halazu.com', { expires: 365, path: '/' });
        $("<li><a target=\"_blank\" href='http://halazu.com'>¹þÀ­×å</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href=''></a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li><li><a target=\"_blank\" href=''></a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"./images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"./images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
    }

    //×Ô¶¨ÒåÍøÖ·°´Å¥
    $("div.mainB_r_c a.amend").click(function () {
        if ($("div.mainB_r_c ul li a.Edit").is(":hidden"))
            $("div.mainB_r_c ul li a.Edit").show();
        else
            $("div.mainB_r_c ul li a.Edit").hide();
        if ($("div.mainB_r_c ul li a.Del").is(":hidden"))
            $("div.mainB_r_c ul li a.Del").show();
        else
            $("div.mainB_r_c ul li a.Del").hide();
        return false;
    })

    //Ìí¼Ó°´Å¥
    $("div.mainB_r_c ul li a.add").click(function () {
        if ($("div.form").is(":hidden")) {
            var cookieadd = $.cookie('iwantcookie');
            if (cookieadd != null) {
                var Link = cookieadd.split("iwantcn");
                if (Link.length < 12) {
                    $("#siteName").val("");
                    $("#siteLink").val("");
                    $("div.form input.AddTo").attr("value", "Ìí¼Ó");
                    $("div.form").show();
                }
                else {
                    alert("ÒÑÂú£¬ÇëÏÈÉ¾³ýÔÙ½øÐÐÌí¼Ó");
                }
            }
            else {
                $("#siteName").val("");
                $("#siteLink").val("");
                $("div.form input.AddTo").attr("value", "Ìí¼Ó");
                $("div.form").show();
            }
        }
        else {
            $("#siteName").val("");
            $("#siteLink").val("");
            $("div.form input.AddTo").attr("value", "Ìí¼Ó");
        }
        $("#siteName").focus();
        return false;
    });

    //ÐÞ¸Ä°´Å¥
    $("div.mainB_r_c ul li a.Edit").live("click", function () {
        var $li = $(this).parent();
        var index = $("div.mainB_r_c ul li").index($li[0]);   //µã»÷±à¼­ËùÔÚli±êÇ©µÄË÷Òý

        $("#hiddenId").attr("value", index);   //Í¬Ê±¸³Öµ¸øÒþ²ØÓò ÕâÑùÐÞ¸ÄµÄÊ±ºò¾ÍÄÜÕÒµ½idÁË

        var cookie = $.cookie('iwantcookie');
        var Link = cookie.split("iwantcn");

        $("#siteName").val(Link[index * 2]);
        $("#siteLink").val(Link[index * 2 + 1]);

        $("div.form input.AddTo").attr("value", "ÐÞ¸Ä");
        $("div.form").show();

        $("#siteName").focus();
        return false;
    })

    //É¾³ý°´Å¥
    $("div.mainB_r_c ul li a.Del").live("click", function () {
        $("div.form").hide();   //±à¼­´°¿ÚÒþ²Ø ·ñÔò³öbug

        var $li = $(this).parent();
        var index = $("div.mainB_r_c ul li").index($li[0]);   //µã»÷±à¼­ËùÔÚli±êÇ©µÄË÷Òý
        $li.remove();   //ÒÆ³ý

        var cookie = $.cookie('iwantcookie');
        var Link = cookie.split("iwantcn");

        Link.splice(index * 2, 2);    //´ÓCookieÀïÉ¾³ý É¾³ý2¸öÊý×éÔªËØ(Ò»¸öÃû×Ö Ò»¸öÁ´½Ó)

        var newCookie = "";
        for (var i = 0; i < Link.length; i++) {
            newCookie += Link[i] + "iwantcn";
        }

        newCookie = newCookie.substring(0, newCookie.length - 7);
        $.cookie('iwantcookie', newCookie, { expires: 365, path: '/' });

        //ÏÔÊ¾¡°Ìí¼ÓÍøÖ·¡±:
        $("div.mainB_r_c ul li:last-child").show();

        return false;
    })


    //±íµ¥ÉÏµÄÌí¼Ó¡¢ÐÞ¸ÄÍøÖ·
    $("div.mainB_r_c div.form input.AddTo").click(function () {
        var siteName = $.trim($("#siteName").val());
        var siteLink = $.trim($("#siteLink").val());
        var cookie = $.cookie('iwantcookie');

        if (siteName == "") {
            $("#siteName").focus();
            return false;
        }
        if (siteLink == "") {
            $("#siteLink").focus();
            return false;
        }
        var type = $("div.form input.AddTo").attr("value");
        switch (type) {
            case "Ìí¼Ó":
                if (siteLink.indexOf('http://') < 0)
                    siteLink = 'http://' + siteLink;
                $("div.form").hide();
                $("<li><a target=\"_blank\" href='" + siteLink + "'>" + siteName + "</a><a href=\"\" title=\"±à¼­\" class=\"Edit\"><img src=\"../../images/edit.png\" alt=\"edit\" /></a><a href=\"\" title=\"É¾³ý\" class=\"Del\"><img src=\"../../images/del.png\" alt=\"del\" /></a></li>").insertBefore("div.mainB_r_c ul li:last-child");
                $("#siteName").val("");
                $("#siteLink").val("");

                if (cookie == null || cookie == "")
                    cookie = siteName + "iwantcn" + siteLink;     //ÒÔiwantcn×÷ÎªcookieÃû×ÖºÍÁ´½ÓÖ®¼äµÄ·Ö¸ô
                else
                    cookie = cookie + "iwantcn" + siteName + "iwantcn" + siteLink;
                $.cookie('iwantcookie', cookie, { expires: 365, path: '/' });

                //Ìí¼ÓµÄÊ±ºòÅÐ¶ÏÆäËûµÄÍøÖ·ÊÇ·ñ´¦ÓÚ±à¼­×´Ì¬
                if ($("div.mainB_r_c ul li a.Edit").is(":visible")) {
                    $("div.mainB_r_c ul li a.Edit").show();
                    $("div.mainB_r_c ul li a.Del").show();
                }

                var cookieadd = $.cookie('iwantcookie');
                var Link = cookieadd.split("iwantcn");
                if (Link.length == 12) {
                    $("div.mainB_r_c ul li:last-child").hide();
                }
                break;
            case "ÐÞ¸Ä":
                if (siteLink.indexOf('http://') < 0)
                    siteLink = 'http://' + siteLink;
                $("div.form").hide();
                var cookie = $.cookie('iwantcookie');
                var Link = cookie.split("iwantcn");
                var index = $("#hiddenId").attr("value");

                Link.splice(index * 2, 2, siteName, siteLink);     //spliceÉ¾³ý²¢²åÈëÊý×éÐÂÔªËØ

                var newCookie = "";
                for (var i = 0; i < Link.length; i++) {
                    newCookie += Link[i] + "iwantcn";
                }
                newCookie = newCookie.substring(0, newCookie.length - 7);

                $('div.mainB_r_c ul li:eq(' + index + ') :first-child').text(siteName);
                $('div.mainB_r_c ul li:eq(' + index + ') :first-child').attr("href", siteLink)    //ÐÞ¸Ä½çÃæÉÏµÄÏÔÊ¾

                $("#siteName").val("");
                $("#siteLink").val("");
                $.cookie('iwantcookie', newCookie, { expires: 365, path: '/' });    //Ð´ÈëÐÂCookie
                break;
            default:
                break;
        }
        return false;  //Í£Ö¹Ã°ÅÝ
    })

    //±íµ¥ÉÏµÄÈ¡Ïû
    $("div.mainB_r_c div.form input.Cancel").click(function () {
        $("#siteName").val("");
        $("#siteLink").val("");
        $("div.form").hide();
        return false;  //Í£Ö¹Ã°ÅÝ
    })

    //µã»÷±íµ¥ÊÂ¼þ
    $("div.form").click(function () {
        return false;   //Í£Ö¹Ã°ÅÝ
    })

    //Ò³ÃæclickÊÂ¼þ
    $(document).click(function () {
        if ($("div.mainB_r_c ul li a.Edit").css("display") == "block" || $("div.mainB_r_c ul li a.Edit").css("display") == "inline") {
            $("div.mainB_r_c ul li a.Edit").hide();
            $("div.mainB_r_c ul li a.Del").hide();

            //alert("²âÊÔ£º±à¼­É¾³ýÒþ²Ø");     //(bug)»ðºüä¯ÀÀÆ÷ÓÒ¼üÒ²»á´¥·¢clickÊÂ¼þ
        }
        if ($("div.form").css("display") == "block") {
            $("div.form").hide();

            //alert("²âÊÔ£ºÌí¼Ó´°¿ÚÒþ²Ø");     //(bug)»ðºüä¯ÀÀÆ÷ÓÒ¼üÒ²»á´¥·¢clickÊÂ¼þ
        }
    })

    //±íµ¥Àï°´»Ø³µºÍEsc¼üÊÂ¼þ
    $("#siteName,#siteLink").keyup(function (e) {
        var key = e.which;
        if (key == 13) {
            $("div.mainB_r_c div.form input.AddTo").click();
        } else if (key == 27) {
            $("div.form").hide();
        }
    })

})